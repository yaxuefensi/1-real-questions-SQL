高频的friend request题目
table
date|time|sender_id|receiver_id|type(这个楼主有点记不清楚了，好像是comment/friend_request.... )


1) calculate the friend requests on a specific date
2) calcualte the trend of acceptance rate
这道题楼主最开始写错了，忘记join table的condition。面试官是一个中国大哥，特别nice，他指出来了，我改正了。
然后他suggest我们要有一个Time period, 如果过了一个time period那不我们就不count这个request了。这个我用的datediff。


我的题是这样的
sender_id| receiver_id| action| date
sender_id: 动作发出者
receiver_id: 动作接受者
action: {request, accept}
date: 动作日期

Q： 某一日的acceptance rate

My Solution:
To confirm question, does thie mean the for all the requests sent in this day, how many of them are accepted, the 
ratio is the acceptance rate?  
1) Do we have a time limit as to how long the request can be waiting? 
2) Can a sender send multiple requests to one receiver? My experience is that once you click the 'add friend' button on facebook,
the button will change to 'friend request sent'. So A send cannot send multiple requests to one receiver. Am I resonable? 
3) Can a receiver accept multiple requests from one sender?

If no limit:

SELECT ROUND(IFNULL(COUNT(accept_tbl.sender_id)/COUNT(request_tbl.sender_id),0),2)
FROM
(
SELECT sender_id, reciever_id
FROM table
WHERE action = 'request' and date = '2018-10-28'
) AS request_tbl
LEFT JOIN
(
SELECT sender_id, receiver_id
FROM table
WHERE action = 'accept' AND date>= '2018-10-28'
) AS accept_tbl
ON request_tbl.sender_id = accept_tbl.receiver_id
 AND request_tbl.receiver_id = accept_tbl.sender_id
 
 IF there is a limit, for example, receiver has to accept within 18 hours. 

SELECT ROUND(IFNULL(COUNT(accept_tbl.sender_id)/COUNT(request_tbl.sender_id),0),2) AS accept_rate
FROM
(
SELECT sender_id, reciever_id,time
FROM table
WHERE action = 'request' and date = '2018-10-28'
) AS request_tbl
LEFT JOIN
(
SELECT sender_id, receiver_id, time
FROM table
WHERE action = 'accept'
) AS accept_tbl
ON request_tbl.sender_id = accept_tbl.receiver_id
AND request_tbl.receiver_id = accept_tbl.sender_id
WHERE DATEDIFF(hour,request_tbl.time,accept_tbl.time) <18



我开始写错了，写成了在某一天内所有的accept除以那天所有的request，后来面试官姐姐说她想要的是在某一天发出的所有request，共有多少被接收，
我说那样的话需要把accpet和request都match起来，然后计算ratio

select ifnull(sum(case when action = 'accept' then 1 else 0 end)/sum(case when action = 'request' then 1 else 0 end),0)
from table. 
where date = '2018-5-2'
这是我第一版

select ifnull(count(t2.date)/count(t1.date),0) as acceptance_rate
from table t1 
left join table t2 
on t1.sender_id = t2.receiver_id and t1.receiver_id = t2.sender_id and t2.action = 'accept'
where t1.action = 'request' and date = '2018-5-2'
这是第二版. 

可能我写的比较快，所以她没有别的任何意见就过了

第二问是紧跟第一问的，如果某天Acceptance rate掉了10%，怎么处理？ 还有一些follow-up 问题，如果你新开发的feature，实现了20%的CTR，你如何
评价这个feature是好的，也就是说你怎么评价这个20%是好还是坏？

这部分，我答得一般，主要是面试官太challenging了，keep asking whatelse...后来阵脚就乱了



Select final_data.sending_time, sum(final_date.indicators)/count(final_date.indicators) as acceptance_rate from 
Select 
        sending.sending_time
        case when accepting.accepting_time is not null then 1 else 0 end as indicator
from
        (Select f1.actor_id, f1.target_id, min(f1.datetime) as sending_time 
        from friending f1
        Where f1.action = ‘request_sent’
        Group by f1.actor_id, f1.target_id ) sending
Left join 
        (Select f2.actor_id, f2.target_id, f2.datetime as accepting_time 
        from friending f2
        Where f2.action = ‘request_accepted’ ) accepting
On (sending.actor_id = accepting.target_id) and (sending.target_id = accepting.actor_id). 
) final_data

补充内容 (2018-9-4 03:17):
看了其他面经 据说是一个人可以发multiple friend request, 但是我不确定一个人能不能多次accept friend request
最后一行少了一个 group by final_data.senidng_time




